(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c50c064"],{"13d5":function(e,t,a){"use strict";var n=a("23e7"),r=a("d58f").left,s=a("a640"),o=a("ae40"),i=a("2d00"),l=a("605d"),c=s("reduce"),d=o("reduce",{1:0}),u=!l&&i>79&&i<83;n({target:"Array",proto:!0,forced:!c||!d||u},{reduce:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"14d1":function(e,t,a){"use strict";a("3deb")},"20df":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("div",[a("a-card",{attrs:{type:"inner",title:"发布单信息"}},[a("detail-list",{attrs:{size:"small"}},[a("detail-list-item",{attrs:{term:"项目"}},[e._v(e._s(e.title.project_name))]),a("detail-list-item",{attrs:{term:"应用"}},[e._v(" "+e._s(e.title.app_name)+" "),a("a",{attrs:{href:e.title.deploy_script_url,target:"_blank"}},[a("a-tag",{attrs:{color:"green"}},[e._v("Deploy")])],1)]),a("detail-list-item",{attrs:{term:"环境"}},[e._v(e._s(e.title.env_name))]),a("detail-list-item",{attrs:{term:"发布单"}},[e._v(e._s(e.title.name))]),a("detail-list-item",{attrs:{term:"发布描述"}},[e._v(e._s(e.title.description))]),a("detail-list-item",{attrs:{term:"部署批次"}},[e._v(e._s(e.title.deploy_no))])],1)],1),a("a-table",{attrs:{columns:e.columns,dataSource:e.dataSource,rowKey:"ip","row-selection":{selectedRowKeys:e.selectedRow,onChange:e.onSelectChange},pagination:{current:e.params.currentPage,pageSize:e.params.pageSize,total:e.total,showSizeChanger:!0,showLessItems:!0,showQuickJumper:!0,showTotal:function(e,t){return"第 "+t[0]+"-"+t[1]+" 条，总计 "+e+" 条"}}},on:{change:e.onChange},scopedSlots:e._u([{key:"release_name",fn:function(t){return[a("a-tooltip",[a("template",{slot:"title"},[e._v(" "+e._s(t.back_release_name)+" ")]),t.main_release_name===e.title.name?a("a-tag",{attrs:{color:"green"}},[e._v(e._s(t.main_release_name))]):e._e(),t.main_release_name!==e.title.name?a("a-tag",{attrs:{color:"red"}},[e._v(e._s(t.main_release_name))]):e._e()],2)]}},{key:"server_log",fn:function(t,n){return[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.logShow(n)}}},[e._v(" 日志 ")])]}}])}),a("div",{staticClass:"alert"},[e.selectedRow?a("a-alert",{staticStyle:{"line-height":"2.4"},attrs:{type:"info","show-icon":!0}},[a("div",{staticClass:"message",attrs:{slot:"message"},slot:"message"},[a("a-row",[a("a-col",{attrs:{span:2}},[e._v(" 已选择 "),a("a",[e._v(e._s(e.selectedRow.length))]),e._v(" 项 ")]),a("a-col",{attrs:{span:22}},[a("a-popconfirm",{attrs:{title:"确定执行回滚操作么？","ok-text":"是","cancel-text":"否"},on:{confirm:e.confirmRollback}},[a("a-button",{staticStyle:{float:"left"},attrs:{type:"primary",disabled:0==e.selectedRow.length}},[e._v("回滚")])],1),a("a-popconfirm",{attrs:{title:"确定执行部署操作么？","ok-text":"是","cancel-text":"否"},on:{confirm:e.confirmDeploy}},[a("a-button",{staticStyle:{float:"right"},attrs:{type:"danger",disabled:0==e.selectedRow.length}},[e._v("部署")])],1)],1)],1)],1)]):e._e()],1)],1),a("a-modal",{attrs:{visible:e.visiableLog,title:"服务器日志",okText:"确定",cancelText:"关闭"},on:{cancel:e.onLogReset,ok:e.onLogReset}},[a("a-card",[a("a-timeline",e._l(e.serverHistorySource,(function(t,n){return a("div",{key:t.id},[t.server==e.selectServer?a("a-timeline-item",{attrs:{color:"blue"}},[a("a-icon",{staticStyle:{"font-size":"16px"},attrs:{slot:"dot",type:"clock-circle-o"},slot:"dot"}),a("a-tag",{attrs:{color:"blue"}},[e._v(e._s(t.server))]),a("a-tag",[e._v(e._s(t.env)+" "+e._s(t.release)+" "+e._s(t.op_type)+" "+e._s(t.action_type))]),a("br"),e._v(" "+e._s(t.log)),a("br"),a("a-tag",{attrs:{color:"green"}},[e._v(e._s(t.create_user))]),e._v(" "+e._s(t.create_date)+" "),a("a-badge",{attrs:{count:t.log_no}})],1):e._e()],1)})),0)],1)],1),a("a-modal",{attrs:{visible:e.visiableDeploy,title:e.deployTitle,okText:"确定",cancelText:"关闭"},on:{cancel:e.onDeployReset,ok:e.onDeployReset}},[a("a-card",[e._v(" 服务器列表："+e._s(this.selectedRow)),a("br"),"wait"===e.deployResult?a("span",[e._v("状态：部署中"),a("a-icon",{style:{fontSize:"24px",color:"#00f"},attrs:{type:"sync",spin:""}}),a("br")],1):"success"===e.deployResult?a("span",[e._v("状态：部署完成"),a("a-icon",{style:{fontSize:"24px",color:"#000"},attrs:{type:"check"}}),e._v(" "),a("br")],1):"noPermission"===e.deployResult?a("span",[e._v("状态：无部署权限"),a("a-icon",{style:{fontSize:"24px",color:"#f00"},attrs:{type:"close"}}),e._v(" "),a("br")],1):a("span",[e._v("状态：部署出错，请查看服务器日志"),a("a-icon",{style:{fontSize:"24px",color:"#f00"},attrs:{type:"close"}}),e._v(" "),a("br")],1),e._v(" 输出记录："),a("span",[e._v(" "+e._s(e.deployLog)+" "),a("br")])])],1)],1)},r=[],s=(a("b0c0"),a("d3b7"),a("25f0"),a("b84f")),o=a("c340"),i=a("8e44"),l=a("c1df"),c=a.n(l),d=o["a"].Item,u=[{title:"IP_Port",dataIndex:"name"},{title:"系统",dataIndex:"system_type"},{title:"环境",dataIndex:"env_name"},{title:"发布单",scopedSlots:{customRender:"release_name"}},{title:"部署日志",scopedSlots:{customRender:"server_log"}},{title:"更新时间",dataIndex:"update_date",sorter:!0,customRender:function(e){return c()(e).format("YYYY-MM-DD hh:mm")}}],p={name:"serviceDeploy",components:{BfTable:s["a"],DetailList:o["a"],DetailListItem:d},data:function(){return{total:0,visiableLog:!1,visiableDeploy:!1,releaseId:"",appId:"",envId:"",title:"",columns:u,dataSource:[],serverHistorySource:[],selectServer:"",selectedRow:[],deployTitle:"",deployType:"",deployResult:"",deployLog:"",params:{currentPage:1,pageSize:20,sort:""}}},created:function(){this.releaseId=this.$route.query.releaseId,this.appId=this.$route.query.appId,this.envId=this.$route.query.envId,this.fetchAllData()},methods:{fetchAllData:function(){this.fetchReleaseData(),this.fetchServerData()},fetchReleaseData:function(){var e=this;i["a"].ReleaseDetail(this.releaseId).then((function(t){var a=t.data;200==t.status&&0==a.code&&(e.title=a.data,e.fetchServerHistoryData())}))},fetchServerData:function(){var e=this,t={app_id:this.appId,env_id:this.envId};i["a"].ServerList(t).then((function(t){if(200==t.status){var a=t.data;e.total=a.data.count,e.dataSource=a.data.results}else e.dataSource=[]}))},fetchServerHistoryData:function(){var e=this,t={release_id:this.releaseId,env_id:this.envId,pageSize:200};i["a"].ServerHistory(t).then((function(t){var a=t.data;200==t.status&&0==a.code&&(e.serverHistorySource=a.data.results)}))},logShow:function(e){this.selectServer=e.name,this.visiableLog=!0},deployShow:function(e){this.selectServer=e.name,this.visiableLog=!0},onLogReset:function(){this.visiableLog=!1},onDeployReset:function(){this.fetchAllData(),this.deployResult="",this.deployLog="",this.visiableDeploy=!1},onPageChange:function(e,t){this.params.currentPage=e,this.params.pageSize=t,this.fetchData()},onSizeChange:function(e,t){this.params.currentPage=1,this.params.pageSize=t,this.fetchData()},onSelectChange:function(e,t){this.selectedRow=e},confirmDeploy:function(e){this.deployTitle="部署",this.deployType="deploy",this.onDeploy()},confirmRollback:function(e){this.deployTitle="回滚",this.deployType="rollback",this.onDeploy()},onDeploy:function(){var e=this,t={target_list:this.selectedRow.toString(),user_id:this.title.create_user,app_name:this.title.app_name,service_port:this.title.service_port,env_name:this.title.env_name,release_name:this.title.name,deploy_no:this.title.deploy_no,deploy_type:this.deployType,op_type:"deploy"};this.deployResult="wait",this.visiableDeploy=!0,i["a"].Deploy(t).then((function(t){var a=t.data;200==t.status&&0==a.code?e.deployResult="success":200==t.status&&2e3==a.code?e.deployResult="noPermission":e.deployResult="failed",e.deployLog=t.data.data}))},onChange:function(e,t,a){console.log("Various parameters",e,t,a);var n=e.current,r=e.pageSize,s=(a.order,a.field);this.params.currentPage=n,this.params.pageSize=r,this.params.sorter=s||"",this.fetchData()}}},f=p,h=(a("14d1"),a("2877")),_=Object(h["a"])(f,n,r,!1,null,"510623b7",null);t["default"]=_.exports},"2d02":function(e,t,a){},"369c":function(e,t,a){},"3deb":function(e,t,a){},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,a){var n=a("1d80"),r=a("5899"),s="["+r+"]",o=RegExp("^"+s+s+"*"),i=RegExp(s+s+"*$"),l=function(e){return function(t){var a=String(n(t));return 1&e&&(a=a.replace(o,"")),2&e&&(a=a.replace(i,"")),a}};e.exports={start:l(1),end:l(2),trim:l(3)}},6531:function(e,t,a){"use strict";a("369c")},a9e3:function(e,t,a){"use strict";var n=a("83ab"),r=a("da84"),s=a("94ca"),o=a("6eeb"),i=a("5135"),l=a("c6b6"),c=a("7156"),d=a("c04e"),u=a("d039"),p=a("7c73"),f=a("241c").f,h=a("06cf").f,_=a("9bf2").f,m=a("58a8").trim,v="Number",y=r[v],g=y.prototype,b=l(p(g))==v,R=function(e){var t,a,n,r,s,o,i,l,c=d(e,!1);if("string"==typeof c&&c.length>2)if(c=m(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+c}for(s=c.slice(2),o=s.length,i=0;i<o;i++)if(l=s.charCodeAt(i),l<48||l>r)return NaN;return parseInt(s,n)}return+c};if(s(v,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var S,w=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof w&&(b?u((function(){g.valueOf.call(a)})):l(a)!=v)?c(new y(R(t)),a,w):R(t)},x=n?f(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),I=0;x.length>I;I++)i(y,S=x[I])&&!i(w,S)&&_(w,S,h(y,S));w.prototype=g,g.constructor=w,o(r,v,w)}},b84f:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"standard-table"},[a("div",{staticClass:"alert"},[e.selectedRows?a("a-alert",{attrs:{type:"info","show-icon":!0}},[a("div",{staticClass:"message",attrs:{slot:"message"},slot:"message"},[e._v(" 已选择 "),a("a",[e._v(e._s(e.selectedRows.length))]),e._v(" 项 "),a("a",{staticClass:"clear",on:{click:e.onClear}},[e._v("清空")]),e._l(e.needTotalList,(function(t,n){return[t.needTotal?a("div",{key:n},[e._v(" "+e._s(t.title)+"总计 "),a("a",[e._v(e._s(t.customRender?t.customRender(t.total):t.total))])]):e._e()]}))],2)]):e._e()],1),a("a-table",{attrs:{bordered:e.bordered,loading:e.loading,columns:e.columns,dataSource:e.dataSource,rowKey:e.rowKey,pagination:e.pagination,expandedRowKeys:e.expandedRowKeys,expandedRowRender:e.expandedRowRender,rowSelection:e.selectedRows?{selectedRowKeys:e.selectedRowKeys,onChange:e.updateSelect}:void 0},on:{change:e.onChange},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots).filter((function(e){return"expandedRowRender"!==e})),(function(t){return{key:t,fn:function(a,n,r){return[e._t(t,null,null,{text:a,record:n,index:r})]}}})),{key:e.$scopedSlots.expandedRowRender?"expandedRowRender":"",fn:function(t,a,n,r){return[e._t(e.$scopedSlots.expandedRowRender?"expandedRowRender":"",null,null,{record:t,index:a,indent:n,expanded:r})]}}],null,!0)},[e._l(Object.keys(e.$slots),(function(t){return a("template",{slot:t},[e._t(t)],2)}))],2)],1)},r=[],s=(a("4de4"),a("d81d"),a("13d5"),a("5530")),o={name:"bfTable",props:{bordered:Boolean,loading:[Boolean,Object],columns:Array,dataSource:Array,rowKey:{type:[String,Function],default:"key"},pagination:{type:[Object,Boolean],default:!0},selectedRows:Array,expandedRowKeys:Array,expandedRowRender:Function},data:function(){return{needTotalList:[]}},methods:{updateSelect:function(e,t){this.$emit("update:selectedRows",t),this.$emit("selectedRowChange",e,t)},initTotalList:function(e){var t=e.filter((function(e){return e.needTotal})).map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{total:0})}));return t},onClear:function(){this.updateSelect([],[]),this.$emit("clear")},onChange:function(e,t,a,n){var r=n.currentDataSource;this.$emit("change",e,t,a,{currentDataSource:r})}},created:function(){this.needTotalList=this.initTotalList(this.columns)},watch:{selectedRows:function(e){this.needTotalList=this.needTotalList.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{total:e.reduce((function(e,a){return e+a[t.dataIndex]}),0)})}))}},computed:{selectedRowKeys:function(){var e=this;return this.selectedRows.map((function(t){return"function"===typeof e.rowKey?e.rowKey(t):t[e.rowKey]}))}}},i=o,l=(a("dc82"),a("2877")),c=Object(l["a"])(i,n,r,!1,null,"67e74d3c",null);t["a"]=c.exports},c340:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:["detail-list","small"===e.size?"small":"large","vertical"===e.layout?"vertical":"horizontal"]},[e.title?a("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),a("a-row",[e._t("default")],2)],1)},r=[],s=(a("a9e3"),a("da05")),o={name:"DetailListItem",props:{term:{type:String,required:!1}},inject:{col:{type:Number}},methods:{renderTerm:function(e,t){return t?e("div",{attrs:{class:"term"}},[t]):null},renderContent:function(e,t){return e("div",{attrs:{class:"content"}},[t])}},render:function(e){var t=this.renderTerm(e,this.$props.term),a=this.renderContent(e,this.$slots.default);return e(s["b"],{props:i[this.col]},[t,a])}},i={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}},l={name:"DetailList",Item:o,props:{title:{type:String,required:!1},col:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"large"},layout:{type:String,required:!1,default:"horizontal"}},provide:function(){return{col:this.col>4?4:this.col}}},c=l,d=(a("6531"),a("2877")),u=Object(d["a"])(c,n,r,!1,null,null,null);t["a"]=u.exports},d58f:function(e,t,a){var n=a("1c0b"),r=a("7b0b"),s=a("44ad"),o=a("50c4"),i=function(e){return function(t,a,i,l){n(a);var c=r(t),d=s(c),u=o(c.length),p=e?u-1:0,f=e?-1:1;if(i<2)while(1){if(p in d){l=d[p],p+=f;break}if(p+=f,e?p<0:u<=p)throw TypeError("Reduce of empty array with no initial value")}for(;e?p>=0:u>p;p+=f)p in d&&(l=a(l,d[p],p,c));return l}};e.exports={left:i(!1),right:i(!0)}},d81d:function(e,t,a){"use strict";var n=a("23e7"),r=a("b727").map,s=a("1dde"),o=a("ae40"),i=s("map"),l=o("map");n({target:"Array",proto:!0,forced:!i||!l},{map:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},dc82:function(e,t,a){"use strict";a("2d02")}}]);