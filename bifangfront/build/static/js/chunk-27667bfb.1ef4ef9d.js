(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27667bfb"],{"13d5":function(e,t,a){"use strict";var n=a("23e7"),o=a("d58f").left,r=a("a640"),i=a("ae40"),s=a("2d00"),c=a("605d"),l=r("reduce"),d=i("reduce",{1:0}),u=!c&&s>79&&s<83;n({target:"Array",proto:!0,forced:!l||!d||u},{reduce:function(e){return o(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"2d02":function(e,t,a){},ab0a:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("div",{staticClass:"search"},[a("a-form",{attrs:{layout:"inline",form:e.form},on:{submit:e.submitHandler}},[a("a-form-item",{attrs:{label:"项目选择"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["projectName",{rules:[{required:!1,message:"请选择项目!"}]}],expression:"['projectName', { rules: [{ required: false, message: '请选择项目!' }] }]"}],staticStyle:{width:"200px"},attrs:{"show-search":"",placeholder:"请选择项目","option-filter-prop":"children","filter-option":e.filterOption},on:{change:e.handleChange}},e._l(e.projectOption,(function(t){return a("a-select-option",{key:t},[e._v(" "+e._s(t)+" ")])})),1)],1),a("a-form-item",{attrs:{label:"组件选择"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["appName",{rules:[{required:!1,message:"请选择发布的组件!"}]}],expression:"['appName', { rules: [{ required: false, message: '请选择发布的组件!' }] }]"}],staticStyle:{width:"200px"},attrs:{"show-search":"",placeholder:"请选择组件","option-filter-prop":"children","filter-option":e.filterOption}},e._l(e.options,(function(t){return a("a-select-option",{key:t.label},[e._v(" "+e._s(t.label)+" ")])})),1)],1),a("a-form-item",{attrs:{label:"发布单号"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["releaseNo",{rules:[{required:!1,message:"Please input your note!"}]}],expression:"['releaseNo', { rules: [{ required: false, message: 'Please input your note!' }] }]"}],attrs:{placeholder:"请输入发布单"}})],1),a("a-form-item",[a("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v(" 查询 ")])],1),a("a-form-item",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return t.preventDefault(),e.onCreateRelease(t)}}},[e._v(" 新建 ")])],1)],1)],1),a("div",[a("bf-table",{attrs:{columns:e.columns,dataSource:e.dataSource,rowKey:"name",pagination:{current:e.params.currentPage,pageSize:e.params.pageSize,total:e.total,showSizeChanger:!0,showLessItems:!0,showQuickJumper:!0,showTotal:function(e,t){return"第 "+t[0]+"-"+t[1]+" 条，总计 "+e+" 条"}}},on:{change:e.onChange},scopedSlots:e._u([{key:"name",fn:function(t){var n=t.text,o=t.record;return a("div",{},[a("a-tooltip",[a("template",{slot:"title"},[e._v(" "+e._s(o.description)+" ")]),a("a",{on:{click:function(t){return e.showReleaseHistory(o)}}},[e._v(" "+e._s(n)+" ")])],2)],1)}},{key:"action",fn:function(t){t.text;var n=t.record;return a("div",{},["Create"==n.deploy_status_name||"BuildFailed"==n.deploy_status_name?a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.buildShow(n)}}},[e._v(" 构建 ")]):a("a-button",{attrs:{type:"default",disabled:""}},[e._v(" 已构建 ")])],1)}},{key:"git_branch",fn:function(t){var n=t.text,o=t.record;return[a("a-tooltip",[a("template",{slot:"title"},[e._v(" "+e._s(o.description)+" ")]),a("a-tag",{attrs:{color:"blue"}},[e._v(e._s(n))])],2)]}}])},[a("template",{slot:"statusTitle"},[a("a-icon",{attrs:{type:"info-circle"},nativeOn:{click:function(t){return e.onStatusTitleClick(t)}}})],1)],2)],1),a("a-modal",{attrs:{visible:e.visiable,title:"软件构建",okText:"确定",cancelText:"关闭"},on:{cancel:e.onReset,ok:e.onReset}},[a("a-card",[a("p",[e._v("发布单: "+e._s(this.modelData.name))]),a("p",[e._v("app: "+e._s(this.modelData.app_name))]),a("p",[e._v("git地址: "+e._s(this.modelData.git_url)+"/"+e._s(this.modelData.project_name)+"/"+e._s(this.modelData.app_name))]),a("p",[e._v("git 项目ID: "+e._s(this.modelData.git_app_id))]),a("p",[e._v("代码分支: "+e._s(this.modelData.git_branch))]),"notBegin"==e.buildStatus?a("div",[a("p",[e._v("构建状态: 尚未开始")]),a("a-button",{attrs:{type:"danger"},on:{click:e.onBuild}},[e._v("开始构建")])],1):"building"==e.buildStatus?a("div",[a("p",[e._v("构建状态: 构建中，请等候"),a("a-icon",{style:{fontSize:"24px",color:"#00f"},attrs:{type:"sync",spin:""}})],1)]):"failed"==e.buildStatus?a("div",[a("p",[e._v("构建状态: 构建失败，请调整后重试。"),a("a-icon",{style:{fontSize:"24px",color:"#f00"},attrs:{type:"close"}})],1),a("a-button",{attrs:{type:"danger"},on:{click:e.onBuild}},[e._v("开始构建")])],1):a("div",[a("p",[e._v("构建状态: 构建完成，如有权限，可操作流转。"),a("a-icon",{style:{fontSize:"24px",color:"#000"},attrs:{type:"check"}})],1),a("a-button",{attrs:{type:"danger"},on:{click:e.onSwitch}},[e._v("快速环境流转")])],1)])],1)],1)},o=[],r=(a("4de4"),a("c740"),a("4160"),a("c975"),a("b0c0"),a("b64b"),a("159b"),a("b84f")),i=a("8e44"),s=a("c1df"),c=a.n(s),l=[{title:"发布单编号",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"项目",dataIndex:"project_name"},{title:"组件",dataIndex:"app_name"},{title:"编译分支",dataIndex:"git_branch",scopedSlots:{customRender:"git_branch"}},{title:"用户",dataIndex:"create_user_name"},{title:"更新时间",dataIndex:"update_date",sorter:!0,defaultSortOrder:"descend",sortDirections:["descend","ascend"],customRender:function(e){return c()(e).format("YYYY-MM-DD hh:mm")}},{title:"操作",scopedSlots:{customRender:"action"}}],d={name:"releaseList",components:{BfTable:r["a"]},data:function(){return{total:0,visiable:!1,modelData:{},buildTimer:null,buildStatus:"notBegin",advanced:!0,columns:l,dataSource:[],selectedRows:[],projects:{},projectOption:[],options:[],params:{name:"",currentPage:1,pageSize:20,sort:""}}},beforeCreate:function(){this.form=this.$form.createForm(this,{name:"releaseList"})},created:function(){this.fetchAppList(),this.fetchData()},destroyed:function(){this.clearBuildTimer()},methods:{toggleAdvanced:function(){this.advanced=!this.advanced},remove:function(){var e=this;this.dataSource=this.dataSource.filter((function(t){return-1===e.selectedRows.findIndex((function(e){return e.key===t.key}))})),this.selectedRows=[]},submitHandler:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){a["timePicker"];t.params.name=a["releaseNo"],t.params.project_name=a["projectName"],t.params.app_name=a["appName"],t.fetchData()}}))},fetchData:function(){var e=this;i["a"].ReleaseList(this.params).then((function(t){var a=t.data;200==t.status&&0==a.code?(e.total=a.data.count,e.dataSource=a.data.results,console.log(e.dataSource)):e.dataSource=[]}))},fetchAppList:function(){var e=this;i["a"].AppList({}).then((function(t){var a=t.data;200==t.status&&0==a.code?(a.data.results.forEach((function(t){e.projects[t.project_name]?e.projects[t.project_name].push({label:t.name,value:t.id}):e.projects[t.project_name]=[{label:t.name,value:t.id}]})),e.projectOption=Object.keys(e.projects)):(e.$message,error("无法获取应用列表~"))}))},handleChange:function(e){this.form.setFieldsValue({appName:""}),this.options=this.projects[e]},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},showReleaseHistory:function(e){console.log(e),this.$router.push({name:"发布单部署历史",params:{releaseId:e.id}})},buildShow:function(e){this.modelData=e,this.visiable=!0},onSwitch:function(){this.$router.push({path:"/environment/environmentList",query:{releaseNo:this.modelData.name}})},onBuild:function(){var e=this,t={app_name:this.modelData.app_name,release_name:this.modelData.name,git_branch:this.modelData.git_branch};i["a"].BuildRelease(t).then((function(t){var a=t.data;200==t.status&&0==a.code?(e.$message.success("开始构建......"),e.getBuildStatus()):200==t.status&&2e3==a.code?e.$message.error("你没有构建此发布单的权限！"):e.$message.error("构建请求失败~")}))},getBuildStatus:function(){var e=this;this.buildTimer=setInterval((function(){var t={app_name:e.modelData.app_name,release_name:e.modelData.name};i["a"].BuildReleaseStatus(t).then((function(t){if(200!=t.status)console.log(t,"no 200"),e.buildTimer&&e.clearBuildTimer();else{var a=t.data.data;"ing"==a?e.buildStatus="building":"success"==a?(e.buildStatus="success",console.log(a),e.buildTimer&&e.clearBuildTimer()):(e.buildStatus="failed",console.log(a),e.buildTimer&&e.clearBuildTimer())}}))}),3e3)},clearBuildTimer:function(){clearInterval(this.buildTimer),this.buildTimer=null},onReset:function(){this.visiable=!1},onPageChange:function(e,t){this.params.currentPage=e,this.params.pageSize=t,this.fetchData()},onSizeChange:function(e,t){this.params.currentPage=1,this.params.pageSize=t,this.fetchData()},onChange:function(e,t,a){console.log("Various parameters",e,t,a);var n=e.current,o=e.pageSize,r=a.order,i=a.field;this.params.currentPage=n,this.params.pageSize=o,console.log("sort order",r),r?"descend"==r&&(i="-"+i):i="",this.params.sort=i,this.fetchData()},onCreateRelease:function(){this.$router.push("createRelease")},handleMenuClick:function(e){"delete"===e.key&&this.remove()}}},u=d,p=(a("cef4"),a("2877")),m=Object(p["a"])(u,n,o,!1,null,"451d6159",null);t["default"]=m.exports},b84f:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"standard-table"},[a("div",{staticClass:"alert"},[e.selectedRows?a("a-alert",{attrs:{type:"info","show-icon":!0}},[a("div",{staticClass:"message",attrs:{slot:"message"},slot:"message"},[e._v(" 已选择 "),a("a",[e._v(e._s(e.selectedRows.length))]),e._v(" 项 "),a("a",{staticClass:"clear",on:{click:e.onClear}},[e._v("清空")]),e._l(e.needTotalList,(function(t,n){return[t.needTotal?a("div",{key:n},[e._v(" "+e._s(t.title)+"总计 "),a("a",[e._v(e._s(t.customRender?t.customRender(t.total):t.total))])]):e._e()]}))],2)]):e._e()],1),a("a-table",{attrs:{bordered:e.bordered,loading:e.loading,columns:e.columns,dataSource:e.dataSource,rowKey:e.rowKey,pagination:e.pagination,expandedRowKeys:e.expandedRowKeys,expandedRowRender:e.expandedRowRender,rowSelection:e.selectedRows?{selectedRowKeys:e.selectedRowKeys,onChange:e.updateSelect}:void 0},on:{change:e.onChange},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots).filter((function(e){return"expandedRowRender"!==e})),(function(t){return{key:t,fn:function(a,n,o){return[e._t(t,null,null,{text:a,record:n,index:o})]}}})),{key:e.$scopedSlots.expandedRowRender?"expandedRowRender":"",fn:function(t,a,n,o){return[e._t(e.$scopedSlots.expandedRowRender?"expandedRowRender":"",null,null,{record:t,index:a,indent:n,expanded:o})]}}],null,!0)},[e._l(Object.keys(e.$slots),(function(t){return a("template",{slot:t},[e._t(t)],2)}))],2)],1)},o=[],r=(a("4de4"),a("d81d"),a("13d5"),a("5530")),i={name:"bfTable",props:{bordered:Boolean,loading:[Boolean,Object],columns:Array,dataSource:Array,rowKey:{type:[String,Function],default:"key"},pagination:{type:[Object,Boolean],default:!0},selectedRows:Array,expandedRowKeys:Array,expandedRowRender:Function},data:function(){return{needTotalList:[]}},methods:{updateSelect:function(e,t){this.$emit("update:selectedRows",t),this.$emit("selectedRowChange",e,t)},initTotalList:function(e){var t=e.filter((function(e){return e.needTotal})).map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{total:0})}));return t},onClear:function(){this.updateSelect([],[]),this.$emit("clear")},onChange:function(e,t,a,n){var o=n.currentDataSource;this.$emit("change",e,t,a,{currentDataSource:o})}},created:function(){this.needTotalList=this.initTotalList(this.columns)},watch:{selectedRows:function(e){this.needTotalList=this.needTotalList.map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{total:e.reduce((function(e,a){return e+a[t.dataIndex]}),0)})}))}},computed:{selectedRowKeys:function(){var e=this;return this.selectedRows.map((function(t){return"function"===typeof e.rowKey?e.rowKey(t):t[e.rowKey]}))}}},s=i,c=(a("dc82"),a("2877")),l=Object(c["a"])(s,n,o,!1,null,"67e74d3c",null);t["a"]=l.exports},c740:function(e,t,a){"use strict";var n=a("23e7"),o=a("b727").findIndex,r=a("44d2"),i=a("ae40"),s="findIndex",c=!0,l=i(s);s in[]&&Array(1)[s]((function(){c=!1})),n({target:"Array",proto:!0,forced:c||!l},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),r(s)},cef4:function(e,t,a){"use strict";a("e052")},d58f:function(e,t,a){var n=a("1c0b"),o=a("7b0b"),r=a("44ad"),i=a("50c4"),s=function(e){return function(t,a,s,c){n(a);var l=o(t),d=r(l),u=i(l.length),p=e?u-1:0,m=e?-1:1;if(s<2)while(1){if(p in d){c=d[p],p+=m;break}if(p+=m,e?p<0:u<=p)throw TypeError("Reduce of empty array with no initial value")}for(;e?p>=0:u>p;p+=m)p in d&&(c=a(c,d[p],p,l));return c}};e.exports={left:s(!1),right:s(!0)}},d81d:function(e,t,a){"use strict";var n=a("23e7"),o=a("b727").map,r=a("1dde"),i=a("ae40"),s=r("map"),c=i("map");n({target:"Array",proto:!0,forced:!s||!c},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},dc82:function(e,t,a){"use strict";a("2d02")},e052:function(e,t,a){}}]);